!function(a){a.module('dragonSearch',['ui.select','ngSanitize','angular-md5','angularMoment','l42y.sprintf']).config(['uiSelectConfig',function(a){a.appendToBody=!1,a.resetSearchInput=!0,a.searchEnabled=!0,a.theme='select2'}]).service('timeTweak',['sprintfFilter','moment',function(a,b){var c='%02d:%02d:%02d:%02d',d='%02d:%02d:%02d',e=function(a){return b.isDuration(a)?a:('string'==typeof a&&this.daysAreDisplayed(a)&&(a=a.replace(':','.')),b.duration(a))}.bind(this),f=function(b,f){b=e(b);var g=b.asDays();return f&&g>=1?a(c,g,b.hours(),b.minutes(),b.seconds()):a(d,b.asHours(),b.minutes(),b.seconds())},g=function(a,c,d){return 3>arguments.length&&(d=this.daysAreDisplayed(a)),f(b.duration(e(a).asMilliseconds()*c),d)}.bind(this);this.daysAreDisplayed=function(a){return a.length>8},this.displayDays=function(a){return f(a,!0)},this.convertDays=function(a){return f(a,!1)},this.reduce=function(a){return g(a,.8)},this.increase=function(a){return g(a,1.25)}}]).service('TimeManager',['timeTweak',function(b){var c=function(a,b,c){this.reduced=b,this.displayDays=c,this.cache={},this.addToCache(a)};c.prototype.getCurrentCacheKeys=function(){return{duration:this.reduced?'reduced':'full',format:this.displayDays?'days':'noDays'}},c.prototype.addToCache=function(a,c){var d=this.getCurrentCacheKeys();return this.cache[d.duration]||(this.cache[d.duration]={}),this.cache[d.duration][d.format]||(this.cache[d.duration][d.format]=2>arguments.length?a:b[c](a)),this},c.prototype.getCurrentCachedTime=function(){var a=this.getCurrentCacheKeys();return this.cache[a.duration][a.format]},this.times=[];var d=function(a,b,d){return Object.defineProperty(a,'TimeManager',{__proto__:null,configurable:!1,enumarable:!1,writable:!1,value:new c(a.time,b,d)})},e=function(a,b){return function(c){return d(c,a,b)}},f=function(b,c,d){a.forEach(this.times,function(a){var e=a.TimeManager;e[c]!=d&&(e[c]=d,e.addToCache(a.time,b),a.time=e.getCurrentCachedTime())})}.bind(this);this.addTimes=function(b,c,d){return a.isArray(b)?this.times=this.times.concat(b.map(e(c,d))):this.addTime(b,c,d),this},this.addTime=function(b,c,e){return a.isArray(b)?this.addTimes(b,c,e):this.times.push(d(b,c,e)),this},this.reduce=function(){return f('reduce','reduced',!0),this},this.increase=function(){return f('increase','reduced',!1),this},this.displayDays=function(){return f('displayDays','displayDays',!0),this},this.convertDays=function(){return f('convertDays','displayDays',!1),this}}]).service('BreedingHints',['$http','TimeManager',function(a,b){this.hints=[],this.findHintById=function(a){for(var b in this.hints)if(this.hints[b].id==a)return b;return-1},this.requestHint=function(c,d,e){var f=this.findHintById(c);return-1==f?a.get('../php/ajax.php',{params:{request:'breed',id:c,reduced:d,displayDays:e}}).then(function(a){this.hints.unshift(a.data),b.addTime(a.data,d,e),a.data.parent1&&b.addTime(a.data.parent1,d,e),a.data.parent2&&b.addTime(a.data.parent2,d,e)}.bind(this)):void(f&&this.hints.unshift(this.hints.splice(f,1)[0]))},this.isBasicBreedingRule=function(a){return!(a.notes||a.breedElems||a.parent1||a.parent2)},this.getHints=function(){return this.hints}}]).controller('BreedingHintsController',['$http','BreedingHints',function(a,b){var c=this;c.hints=b.getHints(),a.get('../php/ajax.php',{params:{request:'breedInit'}}).then(function(a){c.names=a.data}),c.addHint=function(a){return b.requestHint(a||c.dragon.id,c.reduced,c.displayDays)},c.startsWith=function(a,b){return b?(a=a.toLowerCase(),b=b.toLowerCase(),0===a.indexOf(b)):!0},c.setReduced=function(a){return c.reduced=a,this},c.setDisplayDays=function(a){return c.displayDays=a,this},c.isBasicBreedingRule=function(a){return b.isBasicBreedingRule(a)}}]).component('timeTweakBox',{controllerAs:'model',templateUrl:'../html/time-tweak-box.html',bindings:{onReduChange:'&',onDdChange:'&'},controller:['TimeManager',function(a){this.reduced=!1,this.displayDays=!1,this.onReduChange({redu:this.reduced}),this.onDdChange({dd:this.displayDays}),this.tweakTimes=function(){this.reduced?a.reduce():a.increase()},this.toggleFormat=function(){this.displayDays?a.displayDays():a.convertDays()}}]}).service('image',['md5','moment',function(a,b){var c='//vignette3.wikia.nocookie.net/dragonvale/images',d=['Winter','Spring','Summer','Autumn'],e=function(a){return a instanceof b||(a=b()),d[a.quarter()-1]},f={Snowflake:function(a,b){return this.getImg(b+'DragonAdult'+a.slice(-1)+'.png')}.bind(this),Seasonal:function(a){return this.getImg(e(a)+'SeasonalDragonAdult.png')}.bind(this)};f.Monolith=f.Snowflake;var g=function(a){var b=a.match(/(Seasonal|Snowflake|Monolith)/);return b?b[0]:a};this.getImg=function(b){b=b.replace(/ /g,'');var d=a.createHash(b);return[c,d[0],d.substr(0,2),b].join('/')},this.getEggImg=function(a){return this.getImg(g(a)+'DragonEgg.png')},this.getDragonImg=function(a){var b=g(a);return f[b]?f[b](a,b):this.getImg(a+'DragonAdult.png')},this.getElemFlagImg=function(a){return this.getImg(a+'_Flag.png')}}]).component('dragonBox',{controllerAs:'model',templateUrl:'../html/dragon-box.html',bindings:{dragon:'<',onClick:'&'},controller:['image',function(b){this.eggImgURL=b.getEggImg(this.dragon.name),this.dragonImgURL=b.getDragonImg(this.dragon.name),this.elemsImgsURLs=[],a.forEach(this.dragon.elems,function(a){this.elemsImgsURLs.push(b.getElemFlagImg(a))}.bind(this))}]}).component('elemBox',{controllerAs:'model',templateUrl:'../html/elem-box.html',bindings:{name:'<'},controller:['image',function(a){this.imgURL=a.getElemFlagImg(this.name)}]})}(angular);